app.controller("AllocateCheckCtrl",["$scope","http","$timeout",function(e,t,r){e.alerts=[{type:"danger",msg:"Oh snap! Change a few things up and try submitting again."},{type:"success",msg:"Well done! You successfully read this important alert message."}],e.closeAlert=function(t){e.alerts.splice(t,1)},e.stateBox={query:!0,print:!1,record:!1},e.changeState=function(t,r){for(o in e.stateBox)e.stateBox[o]=!1;e.stateBox[t]=!0,"print"==t?i(r):"record"==t&&n(r)},e.queryItem={orderCode:"",demandAgencyName:"",orderTimeStart:"",orderTimeEnd:""},e.queryAllOrdersWithDemandAgency=function(){t.post({method:"queryAllOrdersWithDemandAgency",orderCode:e.queryItem.orderCode,demandAgencyName:e.queryItem.demandAgencyName,orderTimeStart:e.queryItem.orderTimeStart,orderTimeEnd:e.queryItem.orderTimeEnd},URL.OrderServlet).then(function(t){alert("查询成功"),e.goods=t.orders},function(e){alert(JSON.stringify(e))})};var i=function(o){t.post({method:"findOrderWithCheckByOrderCode",orderCode:o},URL.OrderServlet).then(function(t){alert("打印拣货单查询成功"),e.printOrder=t.order,r(function(){$("#"+e.printOrder.orderCode).empty().barcode(""+e.printOrder.orderCode,"code128",{barWidth:2,barHeight:30,showHRI:!1})},1e3)},function(e){alert(JSON.stringify(e))})};e.checkVerify=function(o){t.post({method:"checkOrder",orderCode:o},URL.PickListServlet).then(function(t){alert("复核确认成功！"),e.checkNote=t.pickLists},function(e){alert(JSON.stringify(e))})};var n=function(o){t.post({method:"findPickListByOrderCode",orderCode:o},URL.PickListServlet).then(function(t){alert("复核记录查询成功！"),e.OrderNote=t.pickLists},function(e){alert(JSON.stringify(e))})};e.updateOrderNote=function(){var o=[];angular.forEach(e.OrderNote.pickListItems,function(e){o.push({productCode:e.productCode,pickListRecord:e.pickListRecord,checkRecord:e.checkRecord})}),t.post({method:"updatePickListItem",orderCode:e.OrderNote.orderCode,pickListItems:JSON.stringify(o)},URL.PickListServlet).then(function(e){alert("复核记录保存成功！")},function(e){alert(JSON.stringify(e))})},e.stringItemList=function(e){return JSON.stringify(e[index])}}]),app.controller("AllocateGoodsCtrl",["$scope","http","$timeout","$location","$state",function(e,t,r,i,n){e.stateFactory={query:!0,print:!1,record:!1},e.changeState=function(t,r){for(o in e.stateFactory)e.stateFactory[o]=!1;e.stateFactory[t]=!0,"print"==t?c(r):"record"==t&&d(r)};var a=function(e){$("#"+e).empty().barcode(""+e,"code128",{barWidth:2,barHeight:30,showHRI:!1})};e.queryItem={orderCode:"",demandAgencyName:"",orderTimeStart:"",orderTimeEnd:""},e.queryAllOrdersWithDemandAgency=function(){t.post({method:"queryAllOrdersWithDemandAgency",orderCode:e.queryItem.orderCode,demandAgencyName:e.queryItem.demandAgencyName,orderTimeStart:e.queryItem.orderTimeStart,orderTimeEnd:e.queryItem.orderTimeEnd},URL.OrderServlet).then(function(t){alert("查询成功"),e.goods=t.orders},function(e){alert(JSON.stringify(e))})};var c=function(o){t.post({method:"findPickListsByOrderCode",orderCode:o},URL.PickListServlet).then(function(t){alert("拣货单查询成功"),e.printOrders=t.pickLists,r(function(){s(e.printOrders)},1e3)},function(e){alert(JSON.stringify(e))})};e.renderFinish=function(){console.log("渲染完之后的操作")};var s=function(e){angular.forEach(e,function(e){a(e.pickListCode),console.log("----------------"+e.pickListCode)})},d=function(o){t.post({method:"findPickListByOrderCode",orderCode:o},URL.PickListServlet).then(function(t){alert("拣货记录查询成功！"),e.OrderNote=t.pickLists},function(e){alert(JSON.stringify(e))})};e.updateOrderNote=function(){var o=[];angular.forEach(e.OrderNote.pickListItems,function(e){o.push({productCode:e.productCode,pickListRecord:e.pickListRecord})}),t.post({method:"updatePickListItem",orderCode:e.OrderNote.orderCode,pickListItems:JSON.stringify(o)},URL.PickListServlet).then(function(e){alert("拣货记录保存成功！")},function(e){alert(JSON.stringify(e))})},e.stringItemList=function(e){return JSON.stringify(e[index])}}]),app.controller("CollectStorageCtrl",["$scope","$rootScope","http","instruct",function(e,t,o,r){function i(t){var o=[];angular.forEach(t,function(t){return 0==e.defaultSelect.value&&t.stockQuantity>=t.product.minStock?void console.log("库存不足时查询商品，不符合条件跳过"+t.stockQuantity+"/ "+t.product.minStock):1==e.defaultSelect.value&&t.stockQuantity<=t.product.maxStock?void console.log("库存超量时查询商品，不符合条件跳过"+t.stockQuantity+"/ "+t.product.maxStock):2==e.defaultSelect.value&&(t.stockQuantity<t.product.minStock||t.stockQuantity>t.product.maxStock)?void console.log("库存正常时查询商品，不符合条件跳过"+t.stockQuantity+"/ "+t.product.minStock+"/ "+t.product.maxStock):void o.push({medicName:t.product.productName,medicCode:t.productCode,spec:t.product.specifications,type:t.product.model,unit:t.product.unit,vender:t.product.manufactor,location:t.locatorName,boxNum:t.locatorCode,price:t.product.price,inventory:t.stockQuantity,inventValue:t.stockValue,minInvent:t.product.minStock,maxInvent:t.product.maxStock,inventLevel:t.stockLevel,status:n(t.stockQuantity,t.product.minStock,t.product.maxStock)})}),e.storageList=o}function n(e,t,o){return e>o?{value:1,name:"超量",color:"danger"}:e<t?{value:0,name:"不足",color:"warning"}:{value:2,name:"正常",color:"success"}}r.set(["555"]),t.$broadcast("instructChange"),e.storageList=[{medicName:"健胃消食片",medicCode:"A00101",spec:"规格1",type:"型号1",unit:"24粒/盒",vender:"厂家1",location:"货位1",boxNum:"001",price:1,inventory:100,inventValue:0,minInvent:1,maxInvent:1e3,inventLevel:.75,status:{value:2,name:"正常",color:"success"}},{medicName:"感冒通灵",medicCode:"A00102",spec:"规格2",type:"型号2",unit:"12粒/盒",vender:"厂家2",location:"货位2",boxNum:"002",price:2,inventory:20,inventValue:0,minInvent:30,maxInvent:100,inventLevel:.5,status:{value:0,name:"不足",color:"warning"}},{medicName:"清热解毒胶囊",medicCode:"A00103",spec:"规格3",type:"型号3",unit:"12粒/盒",vender:"厂家3",location:"货位3",boxNum:"003",price:1,inventory:1110,inventValue:0,minInvent:130,maxInvent:500,inventLevel:.25,status:{value:1,name:"超量",color:"danger"}}],e.inventStatus=[{value:0,name:"不足",color:"warning"},{value:1,name:"超量",color:"danger"},{value:2,name:"正常",color:"success"},{value:3,name:"全部",color:"success"}],e.defaultSelect=e.inventStatus[3],e.queryStorage=function(){o.post({method:"queryAllStocks",productCodeOrName:e.qureyValue},URL.stockQurey).then(function(e){alert("queryAllStocks success!"),i(e.stocks)},function(e){console.log("queryAllStocks failed!"+JSON.stringify(e)),alert(e)})},e.queryStorage()}]),app.controller("CollectSupplementCtrl",["$rootScope","$scope","http","instruct",function(e,t,o,r){function i(e){var o=[];angular.forEach(e,function(e){return 0==t.defaultSelect.value&&e.stockQuantity>=e.product.minStock?void console.log("库存不足时查询商品，不符合条件跳过"+e.stockQuantity+"/ "+e.product.minStock):1==t.defaultSelect.value&&e.stockQuantity<=e.product.maxStock?void console.log("库存超量时查询商品，不符合条件跳过"+e.stockQuantity+"/ "+e.product.maxStock):2==t.defaultSelect.value&&(e.stockQuantity<e.product.minStock||e.stockQuantity>e.product.maxStock)?void console.log("库存正常时查询商品，不符合条件跳过"+e.stockQuantity+"/ "+e.product.minStock+"/ "+e.product.maxStock):void o.push({medicName:e.product.productName,medicCode:e.productCode,spec:e.product.specifications,type:e.product.model,unit:e.product.unit,vender:e.product.manufactor,location:e.locatorName,boxNum:e.locatorCode,price:e.product.price,inventory:e.stockQuantity,inventValue:e.stockValue,minInvent:e.product.minStock,maxInvent:e.product.maxStock,inventLevel:e.stockLevel,supplier:e.product.supplier,approvalNumber:e.product.maxStock-e.stockQuantity,status:n(e.stockQuantity,e.product.minStock,e.product.maxStock)})}),t.storageList=o}function n(e,t,o){return e>o?{value:1,name:"超量",color:"danger"}:e<t?{value:0,name:"不足",color:"warning"}:{value:2,name:"正常",color:"success"}}function a(e){for(var o=0;o<t.inventList.length;o++)if(t.inventList[o].medicCode==e.medicCode)return!0;return!1}r.set(["666"]),e.$broadcast("instructChange"),t.storageList=[{medicName:"健胃消食片",medicCode:"A00101",spec:"规格1",type:"型号1",unit:"24粒/盒",vender:"厂家1",price:1,inventory:100,minInvent:1,maxInvent:300,inventLevel:.75,supplier:"供应商",approvalNumber:0,status:{value:2,name:"正常",color:"success"}},{medicName:"感冒通灵",medicCode:"A00102",spec:"规格2",type:"型号2",unit:"12粒/盒",vender:"厂家2",price:1,inventory:30,minInvent:100,maxInvent:200,inventLevel:.5,supplier:"供应商",approvalNumber:0,status:{value:0,name:"不足",color:"warning"}},{medicName:"清热解毒胶囊",medicCode:"A00103",spec:"规格3",type:"型号3",unit:"12粒/盒",vender:"厂家3",location:"货位3",boxNum:"003",price:1,inventory:600,inventValue:0,minInvent:130,maxInvent:300,inventLevel:1/3,supplier:"供应商",approvalNumber:300,status:{value:1,name:"超量",color:"danger"}}],t.inventStatus=[{value:0,name:"不足"},{value:1,name:"超量"},{value:2,name:"正常"},{value:3,name:"全部"}],t.defaultSelect=t.inventStatus[3],t.queryStorage=function(){o.post({method:"queryAllStocks",productCodeOrName:t.qureyValue},URL.stockQurey).then(function(e){alert("queryAllStocks success!"),i(e.stocks)},function(e){console.log("queryAllStocks failed!"+JSON.stringify(e)),alert(e)})},t.queryStorage(),t.selected=[],t.selectedTags=[],t.selectedList=[];var c=function(e,o,r){var i=o.medicCode;if("add"==e&&t.selected.indexOf(i)==-1&&(t.selected.push(i),t.selectedTags.push(r),t.selectedList.push(o)),"remove"==e&&t.selected.indexOf(i)!=-1){var n=t.selected.indexOf(i);t.selected.splice(n,1),t.selectedTags.splice(n,1),t.selectedList.splice(n,1)}console.log("=========$scope.selected=========="+JSON.stringify(t.selected)),console.log("=========$scope.selectedTags=========="+JSON.stringify(t.selectedTags)),console.log("=========selectedList=========="+JSON.stringify(t.selectedList))};t.updateSelection=function(e,t){var o=e.target,r=o.checked?"add":"remove";c(r,t,o.name)},t.isSelected=function(e){return t.selected.indexOf(e)>=0},t.inventList=[],t.addInventory=function(){angular.forEach(angular.copy(t.selectedList),function(e){a(e)||(e.editDisabled=!0,t.inventList.push(e))})},t.confirmInventory=function(){var e=[];angular.forEach(t.inventList,function(t){e.push({productCode:t.medicCode,orderAmount:t.approvalNumber,memo:"筹措清单备注"})});o.post({method:"addRaiseInventory",inventorys:JSON.stringify(e)},URL.raiseInventory).then(function(e){alert("筹措清单提交成功！")},function(e){console.log("addRaiseInventory failed!"+JSON.stringify(e)),alert(e)})},t.editDisabled=!0,t.editOrderAmount=function(e){t.inventList[e].editDisabled=!1},t.remove=function(e){t.inventList.splice(e,1)},t.save=function(e){t.inventList[e].editDisabled=!0},t.cancel=function(e){t.inventList[e].editDisabled=!0,t.inventList[e].approvalNumber=t.inventList[e].maxInvent-t.inventList[e].inventory}}]),app.controller("DicSingleCtrl",["$scope","http","instruct",function(e,t,o){function r(t){e.midware=angular.copy(t)}function i(){e.midware={}}o.set([""]),$rootScope.$broadcast("instructChange");var n=0;e.medList=[],e.editMode=!0,e.addMode=!1,e.midware={},e.medTypeList=["单品","成套"],e.queryInfo={medName:"",medType:""},e.queryMed=function(){t.post({method:"queryProduct",productName:e.queryInfo.medName,herbsType:e.queryInfo.medType},URL.ProductServlet).then(function(t){alert("查询成功"),e.medList=t.products},function(e){alert(JSON.stringify(e))})},e.detailState=!1,e.toggleDetailState=function(t){e.detailState=t},e.showDetails=function(t,o){r(t),n=o,e.toggleDetailState(!0),a=angular.copy(t),e.addMode=!1,e.editMode=!0},e.openSingleDetail=function(){i(),e.toggleDetailState(!0),e.addMode=!0,e.editMode=!1},e.backToQuery=function(){e.toggleDetailState(!1)},e.modifyDetail=function(){e.editMode=!e.editMode,e.editMode&&(e.midware=angular.copy(a))};var a;e.saveDetail=function(){if(e.addMode){if(isEmptyValue(e.midware))return;return void d(angular.copy(e.midware))}e.editMode||(e.editMode=!0,e.medList[n]=angular.copy(e.midware),s(e.midware))},e.selected=[];var c=function(t,o){var r=o;if("add"==t&&e.selected.indexOf(r)==-1&&e.selected.push(r),"remove"==t&&e.selected.indexOf(r)!=-1){var i=e.selected.indexOf(r);e.selected.splice(i,1)}console.log("=========$scope.selected=========="+JSON.stringify(e.selected))};e.updateSelection=function(e,t){var o=e.target,r=o.checked?"add":"remove";c(r,t)},e.isSelected=function(t){return e.selected.indexOf(t)>=0},e.delMedListById=function(){var o="";if(isEmptyValue(e.selected))return void alert("请先选择删除项！！");e.selected.sort(function(e,t){return t-e}),console.log("=========$scope.selected del =========="+JSON.stringify(e.selected));var r=angular.copy(e.medList);return angular.forEach(e.selected,function(t){o=r[t].id+","+o,console.log("========= del =========="+t),e.medList.splice(t,1)}),isEmptyValue(o)?void alert("提交的删除项编号为空，请检查后重新提交！！"):(t.post({method:"deleteProduct",ids:o.substring(0,o.length-1)},URL.ProductServlet).then(function(e){alert("删除成功")},function(t){console.log("deleteSupplyAgency failed!"+JSON.stringify(t)),alert(JSON.stringify(t)),e.medList=r}),void(e.selected=[]))};var s=function(e){t.post({method:"updateProduct",product:JSON.stringify(e)},URL.ProductServlet).then(function(e){alert("已更新修改！")},function(e){alert(JSON.stringify(e))})},d=function(o){t.post({method:"addProduct",product:JSON.stringify(o)},URL.ProductServlet).then(function(t){alert("已添加！"),e.midware.id=t.id,e.medList.push(angular.copy(e.midware)),e.toggleDetailState(!1)},function(e){alert(JSON.stringify(e))})}}]),app.controller("DistrLoadCtrl",["$scope","http",function(e,t){function o(e,t){var o={};for(var r in e)o[r]=t[r];return o}function r(t){for(var r={id:"",carCode:"",carVolume:"",maxWeight:""},i=0;i<t.cars.length;i++){var n=o(r,t.cars[i]);n.orders=[],e.transportList.push(n)}}e.currentIndex=0,e.carDetail={id:"车辆ID",carCode:"车辆编号",carVolume:"车辆容积",maxWeight:"最大载重"},e.chgCar=function(t){var o=e.vehicleList.cars;t<0&&0!=e.currentIndex?(e.currentIndex--,e.carDetail=o[e.currentIndex]):t>0&&e.currentIndex!=o.length-1&&(e.currentIndex++,e.carDetail=o[e.currentIndex])},e.transportList=[],e.vehicleList={},t.post({method:"queryAllCars",numberOrType:""},URL.carQurey).then(function(t){e.vehicleList=t,e.carDetail=e.vehicleList.cars[0],r(e.vehicleList)},function(e){console.log("Order qurey failed!"+JSON.stringify(e)),alert(e)}),e.orders=[{orderCode:"2011010101",receiptAddress:"2ewewewewe",volume:"2000",weight:"900"},{orderCode:"2011010991",receiptAddress:"2ewewewewe",volume:"200",weight:"1000"},{orderCode:"2011056701",receiptAddress:"2ewewewewe",volume:"7000",weight:"1400"},{orderCode:"2011033301",receiptAddress:"2ewewewewe",volume:"2900",weight:"1900"}],e.checkedOrder=[],e.addToTemp=function(t){e.checkedOrder.push(e.orders[t])},e.loadOrders=function(){e.transportList[e.currentIndex].orders.concat(e.checkedOrder)},e.genre=[{city:"浙江",cityGenre:[{distributionSites:"杭州",genreNumber:[{order:"2016hz1111",piece:"hz1",bulk:"hz28",weight:"hz120",deliveryTime:"hz2016-08-19",remainingTime:"hz24h",stowage:"hz444"}]},{distributionSites:"嘉兴",genreNumber:[{order:"2016jx22222222",piece:"jx1",bulk:"jx28",weight:"jx120",deliveryTime:"2jx016-08-19",remainingTime:"jx24h",stowage:"jx444"},{order:"20162jxv2224422",piece:"jxv2",bulk:"3jxv8",weight:"1jxv40",deliveryTime:"20jxv16-08-18",remainingTime:"jxv20h"}]},{distributionSites:"湖州",genreNumber:[{order:"201hz622222222",piece:"hz1",bulk:"2hz8",weight:"hz120",deliveryTime:"2hz016-08-19",remainingTime:"2hz4h",stowage:"4hz44"},{order:"2016hzs22224422",piece:"hzs2",bulk:"3hzs8",weight:"1hzs40",deliveryTime:"20hzs16-08-18",remainingTime:"2hzs0h"},{order:"20162hzd2224422",piece:"hzd2",bulk:"3hzd8",weight:"14hzd0",deliveryTime:"2hzd016-08-18",remainingTime:"2hzd0h"}]}]},{city:"dd江",cityGenre:[{distributionSites:"嘉ddd兴",genreNumber:"111"}]}],e.car=[{brand:"NB0000"},{brand:"NB0002"},{brand:"NB0003"},{brand:"NB0004"},{brand:"NB0005"},{brand:"NB0006"},{brand:"NB0007"},{brand:"NB0008"},{brand:"NB0009"}]}]),app.controller("DistrVehicleCtrl",["$scope","http",function(e,t){function o(e,t){for(var o in t)e[o]=t[o]}e.modalToggle=function(t){e.modalState=t},e.vehicleList={code:0,cars:[{id:1,carCode:"C0001",carName:"1号车",carUnit:"第1车队",carDriver:"李一",maxWeight:3e6,carVolume:26796e3,carNumber:"NC20001",carType:"客车",carLength:580,carWidth:210,carHeigth:220,carStatus:0,memo:"运输车1"},{id:2,carCode:"C0002",carName:"2号车",carUnit:"第2车队",carDriver:"孙二",maxWeight:2e4,carVolume:222960,carNumber:"NC20002",carType:"大巴",carLength:380,carWidth:230,carHeigth:230,carStatus:1,memo:"运输车2"}]},e.detail={},e.tempItem={},e.showDetail=function(t,r){e.modalToggle(!0),o(e.tempItem,r),e.detail.item=r,e.detail.index=t},e.saveChange=function(){var t=e.detail.index,r=e.vehicleList.cars[t];o(r,e.tempItem),e.modalToggle(!1),e.updateCars(JSON.stringify(e.tempItem))},e.cancelChange=function(){o(e.tempItem,e.detail.item),e.modalToggle(!1)},e.newItem={},e.addItem=function(t){e.vehicleList.cars.push({carCode:t.carCode,carNumber:t.carNumber,carName:t.carName,carType:t.carType,carUnit:t.carUnit,carVolume:t.carVolume,carLength:t.carLength,carWidth:t.carWidth,carHeigth:t.carHeigth,carDriver:t.carDriver,memo:t.memo,id:0})},e.rmItem=function(t,o){e.vehicleList.cars.splice(t,1),e.deleteCars(o)},e.iptState=!1,e.iptToggle=function(t){e.iptState=t},e.iptReset=function(t){e.newItem={}},e.iptSave=function(t){e.addItem(t),e.iptToggle(!1),e.addCars(JSON.stringify(t)),e.iptReset(t)},e.queryCars=function(o){t.post({method:"queryAllCars",numberOrType:o},URL.carQurey).then(function(t){console.log("=========查询车辆信息========="+JSON.stringify(t)),e.vehicleList=t},function(e){console.log("queryCars failed!"+JSON.stringify(e)),alert(e)})},e.queryCars(""),e.addCars=function(e){console.log("===========add cars============"+e),t.post({method:"addCar",car:e},URL.carQurey).then(function(e){console.log(JSON.stringify(e)),alert(JSON.stringify("添加成功"+JSON.stringify(e)))},function(e){console.log("addCars failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})},e.updateCars=function(e){console.log("===========updateCars============"+e),t.post({method:"updateCar",car:e},URL.carQurey).then(function(e){console.log(JSON.stringify(e)),alert(JSON.stringify("updateCars成功"+JSON.stringify(e)))},function(e){console.log("updateCars failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})},e.deleteCars=function(e){console.log("===========deleteCars============"+e),t.post({method:"deleteCar",id:e},URL.carQurey).then(function(e){console.log(JSON.stringify(e)),alert(JSON.stringify("deleteCars成功"+JSON.stringify(e)))},function(e){console.log("deleteCars!"+JSON.stringify(e)),alert(JSON.stringify(e))})}}]),app.controller("HeaderCtrl",["$rootScope","$scope","$localstorage","instruct",function(e,t,o,r){e.collapse=!1,t.toggle=function(){e.collapse=!e.collapse};var i=o.getObject("user");t.username=i.userName,t.userInfo=!1,t.toggleUserInfo=function(){t.userInfo=!t.userInfo},t.itemList=r.get(),t.$on("instructChange",function(){t.itemList=r.get()}),t.isInstruct=!1,t.toggleInstruct=function(){t.isInstruct=!t.isInstruct}}]),app.controller("IndexCtrl",["$scope","$rootScope","http",function(e,t,o){}]),app.controller("InstDemandCtrl",["$scope","http",function(e,t){e.detailState=!1,e.addState=!1,e.editMode=!0;var o=0;e.toggleDetailState=function(t,r,i){e.detailState=t,e.editMode=!0,e.addState=!1,o=i,e.demandAgency=angular.copy(r)},e.toggleAddState=function(){e.addState=!0,e.detailState=!0,e.editMode=!1,e.demandAgency={}},e.toggleEditMode=function(t){e.editMode=t,e.addState=!1},e.editDemandAgency=function(t,r){e.editMode=!1,e.detailState=!0,e.addState=!1,o=r,e.demandAgency=angular.copy(t)},e.saveAddOrDetailInfo=function(){return isEmptyValue(e.demandAgency)?void alert("请填写内容后再进行保存！！"):(e.editMode=!1,e.detailState=!1,void(e.addState?r():(e.demandAgencyList[o]=angular.copy(e.demandAgency),i())))},e.type=["","师救护所","团救护所","营救护所","野战医疗所","野战医疗队","野战医院","基地医院"],e.selectedName="",e.demandAgencyName="",e.queryDemandAgency=function(){t.post({method:"findAllDemandAgencys",demandAgencyType:e.selectedName,demandAgencyCode:e.demandAgencyName},URL.DemandAgencyServlet).then(function(t){console.log("========= findAllDemandAgencys success！========="+JSON.stringify(t)),e.demandAgencyList=t.demandAgencies,alert("findAllDemandAgencys success！")},function(e){console.log("findAllDemandAgencys failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})},e.demandAgencyList=[],e.demandAgency={};var r=function(){t.post({method:"addDemandAgency",demandAgency:JSON.stringify(e.demandAgency)},URL.DemandAgencyServlet).then(function(t){e.demandAgency.id=t.id,e.demandAgencyList.push(angular.copy(e.demandAgency)),alert("addDemandAgency success!")},function(e){console.log("demandAgency failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})},i=function(){t.post({method:"updateDemandAgency",demandAgency:JSON.stringify(e.demandAgency)},URL.DemandAgencyServlet).then(function(e){alert("updateDemandAgency success！")},function(e){console.log("updateDemandAgency failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})};e.selected=[];var n=function(t,o){var r=o;if("add"==t&&e.selected.indexOf(r)==-1&&e.selected.push(r),"remove"==t&&e.selected.indexOf(r)!=-1){var i=e.selected.indexOf(r);e.selected.splice(i,1)}console.log("=========$scope.selected=========="+JSON.stringify(e.selected))};e.updateSelection=function(e,t){var o=e.target,r=o.checked?"add":"remove";n(r,t)},e.isSelected=function(t){return e.selected.indexOf(t)>=0},e.delDemandAgency=function(){var o="";if(isEmptyValue(e.selected))return void alert("请先选择删除项！！");e.selected.sort(function(e,t){return t-e}),console.log("=========$scope.selected del =========="+JSON.stringify(e.selected));var r=angular.copy(e.demandAgencyList);return angular.forEach(e.selected,function(t){o=r[t].id+","+o,e.demandAgencyList.splice(t,1)}),isEmptyValue(o)?void alert("提交的删除项编号为空，请检查后重新提交！！"):(t.post({method:"deleteDemandAgency",ids:o.substring(0,o.length-1)},URL.DemandAgencyServlet).then(function(e){alert("eleteDemandAgency success！")},function(e){console.log("deleteDemandAgency failed!"+JSON.stringify(e)),alert(JSON.stringify(e))}),void(e.selected=[]))}}]),app.controller("InstSafetyCtrl",["$scope","http",function(e,t){e.addNewState=!1,e.toggleAddNewState=function(t){e.addNewState=t},e.demandAgencyName="",e.supplyAgencyCode="",e.qurey=function(){t.post({method:"findAllGuaranteeRelationShips",demandAgencyName:e.demandAgencyName,supplyAgencyCode:e.supplyAgencyCode},URL.GuaranteeRelationShipServlet).then(function(t){alert("查询成功"),e.guaranteeRelationShips=t.guaranteeRelationShips},function(e){alert(JSON.stringify(e))})},e.guaranteeRelationShips=[],e.selected=[];var o=function(t,o){var r=o;if("add"==t&&e.selected.indexOf(r)==-1&&e.selected.push(r),"remove"==t&&e.selected.indexOf(r)!=-1){var i=e.selected.indexOf(r);e.selected.splice(i,1)}console.log("=========$scope.selected=========="+JSON.stringify(e.selected))};e.updateSelection=function(e,t){var r=e.target,i=r.checked?"add":"remove";o(i,t)},e.isSelected=function(t){return e.selected.indexOf(t)>=0},e.delGuaranteeRelationShip=function(){var o="";if(isEmptyValue(e.selected))return void alert("请先选择删除项！！");e.selected.sort(function(e,t){return t-e}),console.log("=========$scope.selected del =========="+JSON.stringify(e.selected));var r=angular.copy(e.guaranteeRelationShips);return angular.forEach(e.selected,function(t){o=r[t].id+","+o,console.log("========= del =========="+t),e.guaranteeRelationShips.splice(t,1)}),isEmptyValue(o)?void alert("提交的删除项编号为空，请检查后重新提交！！"):(t.post({method:"deleteGuaranteeRelationShip",ids:o.substring(0,o.length-1)},URL.GuaranteeRelationShipServlet).then(function(e){alert("删除成功")},function(e){alert(JSON.stringify(e))}),void(e.selected=[]))};var r=function(){t.post({method:"findAllSupplyAgencyAndDemandAgencyCodes"},URL.SupplyAgencyServlet).then(function(t){e.addInfoFilter.supplyAgencyCodes=t.supplyAgencyCodes,e.addInfoFilter.demandAgencyCodes=t.demandAgencyCodes},function(e){alert(JSON.stringify(e))})};e.addInfoFilter={supplyAgencyCodes:[],demandAgencyCodes:[]},r(),e.newRelation={demandAgencyCode:"1",supplyAgencyCode:"2"},e.createNewRelation=function(){return console.log("createNewRelation"),isEmptyValue(e.newRelation.supplyAgencyCode)?void alert("请输入供应机构"):isEmptyValue(e.newRelation.demandAgencyCode)?void alert("请输入需求机构"):e.addInfoFilter.supplyAgencyCodes.indexOf(e.newRelation.supplyAgencyCode)==-1?void alert("输入的供应机构不存在，请查证后重新输入！！！"):e.addInfoFilter.demandAgencyCodes.indexOf(e.newRelation.demandAgencyCode)==-1?void alert("输入的需求机构不存在，请查证后重新输入！！！"):void t.post({method:"addGuaranteeRelationShip",guaranteeRelationShip:JSON.stringify(e.newRelation)},URL.GuaranteeRelationShipServlet).then(function(e){alert("建立成功！！！")},function(e){alert(JSON.stringify(e))})}}]),app.controller("InstSupplyCtrl",["$scope","http",function(e,t){e.detailState=!1,e.addState=!1,e.editMode=!0;var o=0;e.toggleDetailState=function(t,r,i){e.detailState=t,e.editMode=!0,e.addState=!1,e.selected=[],t&&(o=i,e.supplyAgency=angular.copy(r),console.log("===="+JSON.stringify(e.supplyAgency)),e.supplyAgencyJobs=e.supplyAgency.supplyAgencyJobs,e.addPosiState=!1,e.newSupplyJob={roleCode:"",roleName:"",roleGroup:""})},e.toggleAddState=function(){e.addState=!0,e.detailState=!0,e.editMode=!1,e.addPosiState=!1,e.newSupplyJob={roleCode:"",roleName:"",roleGroup:""},e.supplyAgency={},e.supplyAgencyJobs=[],e.supplyAgency.supplyAgencyJobs=e.supplyAgencyJobs,e.selected=[]},e.toggleEditMode=function(t){e.editMode=t,e.addState=!1,e.addPosiState=!1,e.newSupplyJob={roleCode:"",roleName:"",roleGroup:""}},e.editSupplyAgency=function(t,r){e.editMode=!1,e.detailState=!0,e.addState=!1,o=r,e.supplyAgency=angular.copy(t),e.selected=[]},e.saveAddOrDetailInfo=function(){return isEmptyValue(e.supplyAgency)?void alert("请填写内容后再进行保存！！"):(e.selected=[],e.editMode=!1,e.detailState=!1,void(e.addState?addSupplyAgency():(e.supplyAgencies[o]=angular.copy(e.supplyAgency),r())))},e.addGroupState=!1,e.toggleAddGroupState=function(t){e.addGroupState=t},e.addPosiState=!1,e.toggleAddPosiState=function(t){e.addPosiState=t},e.type=["","药材仓库","药材供应站","野战药材仓库","野战药材保障队"],e.selectedName="",e.supplyAgencyName="",e.findAllSupplyAgencys=function(){t.post({method:"findAllSupplyAgencys",supplyAgencyName:e.supplyAgencyName,supplyAgencyType:e.selectedName},URL.SupplyAgencyServlet).then(function(t){e.supplyAgencies=t.supplyAgencies,alert("findAllSupplyAgencys success！")},function(e){console.log("findAllSupplyAgencys failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})},e.supplyAgencies=[],e.supplyAgency={},addSupplyAgency=function(){t.post({method:"addSupplyAgency",supplyAgency:JSON.stringify(e.supplyAgency),supplyAgencyJobs:JSON.stringify(e.supplyAgency.supplyAgencyJobs)},URL.SupplyAgencyServlet).then(function(t){alert("addSupplyAgency success！"),e.supplyAgency.id=t.id,e.supplyAgencies.push(angular.copy(e.supplyAgency))},function(e){console.log("addSupplyAgency failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})};var r=function(){t.post({method:"updateSupplyAgency",supplyAgency:JSON.stringify(e.supplyAgency),supplyAgencyJobs:JSON.stringify(e.supplyAgency.supplyAgencyJobs)},URL.SupplyAgencyServlet).then(function(e){alert("updateSupplyAgency success!")},function(e){console.log("updateSupplyAgency failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})};e.selected=[];var i=function(t,o){var r=o;if("add"==t&&e.selected.indexOf(r)==-1&&e.selected.push(r),"remove"==t&&e.selected.indexOf(r)!=-1){var i=e.selected.indexOf(r);e.selected.splice(i,1)}console.log("=========$scope.selected=========="+JSON.stringify(e.selected))};e.updateSelection=function(e,t){var o=e.target,r=o.checked?"add":"remove";i(r,t)},e.isSelected=function(t){return e.selected.indexOf(t)>=0},e.delSupplyAgency=function(){var o="";if(isEmptyValue(e.selected))return void alert("请先选择删除项！！");e.selected.sort(function(e,t){return t-e}),console.log("=========$scope.selected del =========="+JSON.stringify(e.selected));var r=angular.copy(e.supplyAgencies);return angular.forEach(e.selected,function(t){o=r[t].id+","+o,console.log("========= del =========="+t),e.supplyAgencies.splice(t,1)}),isEmptyValue(o)?void alert("提交的删除项编号为空，请检查后重新提交！！"):(t.post({method:"deleteSupplyAgency",ids:o.substring(0,o.length-1)},URL.DemandAgencyServlet).then(function(e){alert("删除成功")},function(e){console.log("deleteSupplyAgency failed!"+JSON.stringify(e)),alert(JSON.stringify(e))}),void(e.selected=[]))},e.supplyAgencyJobs=[{roleCode:"101",roleName:"保障队队长",roleGroup:"保障队"},{roleCode:"102",roleName:"供应组组长",roleGroup:"供应组"}],e.editJobMode=!0,e.newSupplyJob={roleCode:"",roleName:"",roleGroup:""},e.addNewJob=function(){return isEmptyValue(e.newSupplyJob)?void alert("请输入岗位信息后再保存！"):void e.supplyAgencyJobs.push(angular.copy(e.newSupplyJob))};var n={};e.setSupplyJob=function(t,o){e.supplyAgencyJobs[t].editJobMode?(e.supplyAgencyJobs[t]=n,e.supplyAgencyJobs[t].editJobMode=!1):(n=angular.copy(e.supplyAgencyJobs[t]),e.supplyAgencyJobs[t].editJobMode=!0)},e.saveSupplyJob=function(t,o){e.supplyAgencyJobs[t].editJobMode=!1,e.newSupplyJob={roleCode:"",roleName:"",roleGroup:""}},e.delSupplyJobs=function(){if(isEmptyValue(e.selected))return void alert("请先选择删除项！！");e.selected.sort(function(e,t){return t-e}),console.log("=========$scope.selected del =========="+JSON.stringify(e.selected));angular.copy(e.supplyAgencyJobs);angular.forEach(e.selected,function(t){console.log("========= del =========="+t),e.supplyAgencyJobs.splice(t,1)}),e.selected=[]}}]),app.controller("LoadQueryCtrl",["$scope","http","$timeout",function(e,t,r){e.stateFactory={query:!0,print:!1},e.changeState=function(t,r){for(o in e.stateFactory)e.stateFactory[o]=!1;e.stateFactory[t]=!0,"print"==t&&e.clickPrintOrder(r)},e.print=function(e){var t=document.getElementById(e).innerHTML;document.body.innerHTML=t,window.print()},e.findAllStowages=function(){t.post({method:"findAllStowages",stowageCode:e.stowageCode,carCode:e.carCode,orderCode:e.orderCode},URL.StowageServlet).then(function(t){alert("配载查询成功"),e.stowages=t.stowages},function(e){alert(JSON.stringify(e))})},e.clickPrintOrder=function(t){e.orderPrintInfo=t,r(function(){$("#"+t.stowageCode).empty().barcode(""+t.stowageCode,"code128",{barWidth:2,barHeight:30,showHRI:!1})},500)},e.selected=[];var i=function(t,o){var r=o;if("add"==t&&e.selected.indexOf(r)==-1&&e.selected.push(r),"remove"==t&&e.selected.indexOf(r)!=-1){var i=e.selected.indexOf(r);e.selected.splice(i,1)}console.log("=========$scope.selected=========="+JSON.stringify(e.selected))};e.updateSelection=function(e,t){var o=e.target,r=o.checked?"add":"remove";i(r,t)},e.isSelected=function(t){return e.selected.indexOf(t)>=0},e.delStowages=function(){var t="";if(isEmptyValue(e.selected))return void alert("请先选择删除项！！");e.selected.sort(function(e,t){return t-e}),console.log("=========$scope.selected del =========="+JSON.stringify(e.selected));var o=angular.copy(e.stowages);return angular.forEach(e.selected,function(r){t=o[r].id+","+t,console.log("========= del =========="+r),e.stowages.splice(r,1)}),isEmptyValue(t)?void alert("提交的删除项编号为空，请检查后重新提交！！"):(n(t.substring(0,t.length-1)),void(e.selected=[]))},e.deleStowageByIndex=function(t,o){e.stowages.splice(t,1),n(o)};var n=function(e){alert(e),t.post({method:"deleteStowage",ids:e},URL.StowageServlet).then(function(e){alert("删除成功")},function(e){console.log("delete stowages failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})}}]),app.controller("LoadSelectCtrl",["$scope","http",function(e,t){e.model={isChecked:"0",isChecked1:"0"},e.queryAllCarsWithStatus=function(){t.post({method:"queryAllCarsWithStatus"},URL.CarServlet).then(function(t){e.cars=t.cars},function(e){alert(JSON.stringify(e))})},e.findAllInvoices=function(){t.post({method:"findAllInvoices"},URL.InvoiceServlet).then(function(t){e.invoices=t.invoices},function(e){alert(JSON.stringify(e))})},e.queryAllCarsWithStatus(),e.findAllInvoices(),e.stowage={carCode:"",volumePercent:0,weightPercent:0,carVolume:0,maxWeight:0,transportRoute:"",invoiceCode:""},e.commit=function(){t.post({method:"addStowage",stowage:JSON.stringify(e.stowage)},URL.StowageServlet).then(function(e){alert("确认成功！！！")},function(e){alert(JSON.stringify(e))})};var o;e.selectCar=function(t){e.stowage.carCode=e.cars[t].carCode,e.stowage.carVolume=e.cars[t].carVolume,e.stowage.maxWeight=e.cars[t].maxWeight,isEmptyValue(i)||(e.stowage.invoiceCode=i.invoiceCodes,e.stowage.weightPercent=i.weight/e.cars[t].maxWeight,
e.stowage.volumePercent=i.volume/e.cars[t].carVolume),o=angular.copy(e.cars[t])},e.selected=[];var r=function(t,o,r){var i=o;if("add"!=t||n(i)||e.selected.push(i),"remove"==t&&n(i)){var a=e.selected.indexOf(i);e.selected.splice(a,1)}e.selectInvoice(o),console.log("=========$scope.selected=========="+JSON.stringify(e.selected))};e.updateSelection=function(e,t,o){var i=e.target,n=i.checked?"add":"remove";r(n,t,o)};var i,n=function(t){return e.selected.indexOf(t)>=0},a=function(){var t={invoiceCodes:"",weight:0,volume:0},o=angular.copy(e.invoices);return angular.forEach(e.selected,function(e){t.invoiceCodes=o[e].invoiceCode+","+t.invoiceCodes,t.weight=t.weight+o[e].weight,t.volume=t.volume+o[e].volume}),t.invoiceCodes=t.invoiceCodes.substring(0,t.invoiceCodes.length-1),t};e.selectInvoice=function(t){isEmptyValue(o)||(e.stowage.carCode=o.carCode,e.stowage.carVolume=o.carVolume,e.stowage.maxWeight=o.maxWeight),e.stowage.invoiceCode=a().invoiceCodes,e.stowage.weightPercent=a().weight/e.stowage.maxWeight,e.stowage.volumePercent=a().volume/e.stowage.carVolume,i=angular.copy(a())},e.cancel=function(){e.stowage={},e.model={isChecked:"0",isChecked1:"0"},e.selected=[],angular.forEach(e.invoices,function(e){e.isChecked=""})}}]),app.controller("LoginCtrl",["$scope","http","$state","$localstorage",function(e,t,o,r){e.loginInfo={name:"",password:""},e.login=function(){return console.log("login info:"+JSON.stringify(e.loginInfo)),e.loginInfo.name?e.loginInfo.password?void t.post(e.loginInfo,URL.login).then(function(e){if(console.log(JSON.stringify(e)),e.flag){var t={userCode:e.userCode,userName:e.userName,role:e.role};console.log("USER==="+JSON.stringify(t)),r.setObject("user",t);var i=r.getObject("user");console.log("USER1==="+JSON.stringify(i)),o.go("home.dashboard")}else alert("密码或用户名有误，请重新输入！！")},function(e){console.log("login failed!"+JSON.stringify(e)),alert(e)}):void alert("请输入密码"):void alert("请输入用户名")}}]),app.controller("ModeCtrl",["$scope","http",function(e,t){e.data=[{title:"药材仓库",nodes:[{title:"第一药材仓库",nodes:[]},{title:"第二药材仓库",nodes:[]},{title:"第三药材仓库",nodes:[]}]},{title:"药材供应站",nodes:[{title:"第一药材供应站",nodes:[]},{title:"第二药材供应站",nodes:[]},{title:"第三药材供应站",nodes:[]}]},{title:"野战药材保障队",nodes:[{title:"第一野战药材保障队",nodes:[]},{title:"第二野战药材保障队",nodes:[]},{title:"第三野战药材保障队",nodes:[]}]}],e.modeList=[{title:"业务模式",nextStep:2},{title:"练习模式",nextStep:3},{title:"考核模式",nextStep:3}],e.toggle=function(e){e.toggle()},e.mode=1,e.modeName="",e.changeMode=function(t,o){e.mode=t,e.modeName=e.modeList[o].title}}]),app.controller("OrderAddCtrl",["$scope","http",function(e,t){e.orderForm={method:"addOrder",orderTime:secondsToData((new Date).getTime()),deliveryTime:"",customerCode:"",customerName:"",receiver:"",tel:"",receiveMode:"",receiptAddress:"",memo:"",orderItems:"[]"},e.items=[],e.newItem={},e.addItem=function(t){e.items.push({productCode:t.code,total:t.price*t.amount,unit:t.unit,price:t.price,productNum:t.amount,size:t.size,name:t.name})},e.rmItem=function(t){e.items.splice(t,1)},e.iptState=!1,e.iptToggle=function(t){e.iptState=t},e.iptReset=function(t){e.newItem={}},e.iptSave=function(t){e.addItem(t),e.iptToggle(!1),e.iptReset(t)},e.reset=function(){e.items=[],e.orderForm={}},e.submitOrder=function(){e.orderForm.orderItems=JSON.stringify(e.items),console.log(JSON.stringify(e.orderForm)+"==============="+e.orderForm.orderItems),t.post(e.orderForm,URL.orderAdd).then(function(e){console.log(JSON.stringify(e)),alert("订单添加成功！")},function(e){console.log("submitOrder failed!"+JSON.stringify(e))})};var o=[],r=function(){t.post({method:"queryProduct"},URL.productQurey).then(function(e){console.log("queryProduct info --->"+e),o=e.products},function(e){console.log("queryProduct failed!"+JSON.stringify(e))})};r(),e.change=function(t){angular.forEach(o,function(o){if(t.code==o.productCode)return e.newItem.name=o.productName,e.newItem.size=o.specifications,e.newItem.unit=o.unit,e.newItem.price=o.price,e.newItem.amount=o.averageNumber,void(e.newItem.sum=e.newItem.price*e.newItem.amount)})},e.receiptMethod=[{value:0,name:"配送"},{value:1,name:"自取"}],e.receiptSelect=e.receiptMethod[0],e.orderMethod=[{value:0,name:"电话订单"},{value:1,name:"网络电子订单"},{value:2,name:"邮件订单"}],e.orderSelect=e.orderMethod[0]}]),app.controller("OrderAuditCtrl",["$scope","http",function(e,t){function o(e){var t=[];return angular.forEach(e,function(e){"未审核"!=e.orderStatus&&"有疑问"!=e.orderStatus||t.push(e)}),t}e.auditState=!0,e.auditStateToggle=function(t){e.auditState=t},e.orderList={code:0,order:[{id:29,orderCode:"201601010010",customerCode:"B0001",customerName:"张三",orderType:"电子订单",orderTime:"2016-07-21 20:43:52",deliveryTime:"2016-07-22 20:44:03",orderStatus:"未处理",receiver:"王建国",receiptAddress:"浙江省湖州市",tel:"13456780101",receiptType:"配送",shipMethod:"专门",payMethod:1,shipTime:"",orderProgress:"",memo:"2222",level:0},{id:39,orderCode:"201601010010",customerCode:"B0001",customerName:"张五",orderType:"电子订单",orderTime:"2016-07-21 20:43:52",deliveryTime:"2016-07-22 20:44:03",orderStatus:"未处理",receiver:"王建国",receiptAddress:"浙江省湖州市",tel:"13456780101",receiptType:"配送",shipMethod:"专门",payMethod:1,shipTime:"",orderProgress:"",memo:"2222",level:0}]},e.items=[{id:0,productCode:"100100010",ordinaryName:"阿莫西林胶囊",specifications:"10mg",unit:"粒",price:"0.15",productNumber:"1000",total:"150",stockNumber:"",lack:200,ditribute:800}],e.detail={},e.showDetail=function(t){e.auditStateToggle(!1),r(t.orderCode)},e.newItem={},e.addItem=function(t){e.items.push({productCode:t.productCode,ordinaryName:t.ordinaryName,specifications:t.specifications,unit:t.unit,price:t.price,productNumber:t.productNumber,total:t.price*t.productNumber,stockNumber:t.stockNumber,lack:t.productNumber-t.stockNumber<0?t.stockNumber-t.productNumber:0,ditribute:t.ditribute,id:e.items.length})},e.rmItem=function(t){e.items.splice(t,1)},e.iptState=!1,e.iptToggle=function(t){e.iptState=t},e.iptReset=function(t){e.newItem={}},e.iptSave=function(t){e.addItem(t),e.iptToggle(!1),e.iptReset(t)},e.auditForm={},e.auditSubmit=function(){for(var t in e.item)e.auditForm[t]=e.item[t]},e.shipMethod="",e.auditForm.shipMethod=e.shipMethod,t.post({method:"queryAllOrders"},URL.orderQurey).then(function(t){e.orderList.order=o(t.order)},function(e){console.log("Order qurey failed!"+JSON.stringify(e))});var r=function(o){t.post({method:"queryOrderAndItem",orderCode:o},URL.orderQurey).then(function(t){console.log("queryOrderAndItem:"+JSON.stringify(t)),alert("queryOrderAndItem success!"),e.detail=t.order,e.items=t.order.orderItems,e.detail.deliveryTime=secondsToData(t.order.deliveryTime),e.detail.orderTime=secondsToData(t.order.orderTime),e.detail.intendDeliveryTime=secondsToData(t.order.deliveryTime)},function(e){console.log("Order qurey failed!"+JSON.stringify(e))})},i=[],n=function(){t.post({method:"queryProduct"},URL.productQurey).then(function(e){console.log("queryProduct info --->"+e),alert("queryProduct success!"),i=e.products},function(e){console.log("queryProduct failed!"+JSON.stringify(e))})};n(),e.change=function(t){angular.forEach(i,function(o){if(t.productCode==o.productCode)return void(e.newItem=o)})};var a={method:"updateOrderPass",oldOrderId:"50",orderCode:"20160804103205",itemIds:"37,38",customerCode:"B0002",customerName:"1军1师2团团救护所",orderTime:"2016-08-0310: 07: 50",deliveryTime:"2016-08-0510: 07: 50",receiptAddress:"上海张江",receiver:"李四",tel:"2212345678",intendDeliveryTime:"2016-08-0610: 07: 50",packageMethod:"0",shipMethod:"0",orderStatus:"1",orderItems:"[{'orderCode':'20160804103205','productCode':10000001,'productNumber':15,'total':150}]",memo:"备注更新"};e.updateOrder=function(e){t.post(c(e),URL.orderAudit).then(function(t){alert("1"==e?"订单已确认":"已转至疑问订单")},function(e){})};var c=function(t){return a.oldOrderId=e.detail.id+"",a.orderCode=e.detail.orderCode+"",a.customerCode=e.detail.customerCode,a.customerName=e.detail.customerName,a.orderTime=e.detail.orderTime,a.deliveryTime=e.detail.deliveryTime,a.receiptAddress=e.detail.receiptAddress,a.receiver=e.detail.receiver,a.tel=e.detail.tel,a.intendDeliveryTime=e.detail.intendDeliveryTime,a.packageMethod=e.pmSelect.value+"",a.shipMethod=e.shipSelect.value+"",a.orderStatus=t,a.memo=e.detail.memo+"",a.orderItems=JSON.stringify(e.items),a.itemIds=s(),a},s=function(){var t="";return angular.forEach(e.items,function(e){t+=e.id+","}),t.substring(0,t.length-1)};e.packageMethod=[{value:0,name:"纸箱"},{value:1,name:"PP中空板箱"},{value:2,name:"制式医疗箱"}],e.pmSelect=e.packageMethod[0],e.shipMethod=[{value:0,name:"专车"},{value:1,name:"拼车"}],e.shipSelect=e.shipMethod[0],e.receiptMethod=[{value:0,name:"配送"},{value:1,name:"自取"}],e.receiptSelect=e.receiptMethod[0],e.getValue=function(e){}}]),app.controller("OrderQueryCtrl",["$scope","http",function(e,t){e.modalToggle=function(t,o){e.modalState=t,e.modalInfo=o};var o=[{id:1,shipMethod:"专门",payMethod:0,shipTime:"",level:0,oldOrderId:0,orderMark:0,orderTime:"2016-07-25 10:00:00",deliveryTime:"2016-08-03 10:00:00",customerCode:"90010011",customerName:"团救护所1",receiver:"王大锤",tel:"111111111111111",receiveMode:"header1",receiptAddress:"地1",orderStatus:"已审核",memo:"hello",orderProgress:"在配货",orderCode:"2016080210"},{id:2,shipMethod:"专门",payMethod:0,shipTime:"",level:0,oldOrderId:0,orderMark:0,orderTime:"2016-08-02 10:00:00",deliveryTime:"2016-08-04 17:50:00",customerCode:"90010012",customerName:"团救护所2",receiver:"张欣",tel:"2222222",receiveMode:"header2",receiptAddress:"地2",orderStatus:"未审核",memo:"222",orderProgress:"在集货",orderCode:"2016080211"},{id:3,shipMethod:"专门",payMethod:0,shipTime:"",level:0,oldOrderId:0,orderMark:0,orderTime:"2016-08-03 10:00:00",deliveryTime:"2016-08-02 04:30:00",customerCode:"90010013",customerName:"团救护所3",receiver:"李楠",tel:"333333333",receiveMode:"header3",receiptAddress:"地3",orderStatus:"有疑问",memo:"333",orderProgress:"在运输",orderCode:"2016080212"},{id:4,shipMethod:"专门",payMethod:0,shipTime:"",level:0,oldOrderId:0,orderMark:0,orderTime:"2016-08-03 10:00:00",deliveryTime:"2016-08-02 23:00:00",customerCode:"90010014",customerName:"团救护所4",receiver:"胡云",tel:"444444",receiveMode:"header4",receiptAddress:"地4",orderStatus:"已审核",memo:"444",orderProgress:"在运输",orderCode:"2016080213"},{id:5,shipMethod:"专门",payMethod:0,shipTime:"",level:0,oldOrderId:0,orderMark:0,orderTime:"2016-08-04 10:00:00",deliveryTime:"2016-08-04 10:00:00",customerCode:"90010015",customerName:"团救护所5",receiver:"小红",tel:"5555555",receiveMode:"header5",receiptAddress:"地5",orderStatus:"未审核",memo:"555",orderProgress:"在运输",orderCode:"2016080214"},{id:6,shipMethod:"专门",payMethod:0,shipTime:"",level:0,oldOrderId:0,orderMark:0,orderTime:"2016-08-05 10:00:00",deliveryTime:"2016-08-06 10:00:00",customerCode:"90010016",customerName:"团救护所6",receiver:"逍遥",tel:"666666",receiveMode:"header6",receiptAddress:"地6",orderStatus:"已审核",memo:"6666",orderProgress:"在运输",orderCode:"2016080215"}];e.qureyInfo={method:"queryAllOrders"},t.post(e.qureyInfo,URL.orderQurey).then(function(t){console.log(JSON.stringify(t)),e.orderList=t.order,o=t.order},function(t){console.log("Order qurey failed!"+JSON.stringify(t)),e.orderList=o,alert(t)}),e.filters={key:"all",value:""},e.qureyParam=[{key:"all",value:"全部"},{key:"orderStatus",value:"未审核"},{key:"orderStatus",value:"已审核"},{key:"orderStatus",value:"有疑问"},{key:"orderProgress",value:"在配货"},{key:"orderProgress",value:"在集货"},{key:"orderProgress",value:"在装载"},{key:"orderProgress",value:"在运输"}],e.times=[{tip:"6小时 |",hours:6},{tip:"12小时 |",hours:12},{tip:"24小时 |",hours:24},{tip:"48小时|",hours:48},{tip:"72小时 ",hours:72}],e.filterOrder=function(t){var r=[];return"all"==t.key?void(e.orderList=o):(angular.forEach(o,function(e){e[t.key]==t.value&&r.push(e)}),void(e.orderList=r))},e.filterTime=function(t){var r=[],i=Date.parse(new Date);i/=1e3,angular.forEach(o,function(e){var o=Date.parse(new Date(e.deliveryTime));o/=1e3;var n=parseInt((o-i)/60/60);n<t&&r.push(e)}),e.orderList=r},e.qureyByOrderTime=function(){var t=[],r=Date.parse(new Date(e.date1)),i=Date.parse(new Date(e.date2));console.log("data1 is "+r+"===date2 is "+i),angular.forEach(o,function(e){var o=Date.parse(new Date(e.orderTime));o<i&&o>r&&t.push(e)}),e.orderList=t}}]),app.controller("PrintCtrl",["$scope","http","$location","printlist","$state","$stateParams",function(e,t,o,r,i,n){function a(e){return o.search()[e]}e.orderToPrint=[];var c=JSON.parse(a("items"));c instanceof Array?e.orderToPrint=c:e.orderToPrint[0]=c,e.print=function(){window.print()},e.$on("ngRepeatFinished",function(){$(".barcode").each(function(e,t){var o=$(this).data("code");$(this).barcode(""+o,"code128",{barWidth:2,barHeight:30,showHRI:!1})})})}]),app.controller("SideNavCtrl",["$scope","$http","$state","$stateParams","$localstorage",function(e,t,o,r,i){e.list={parent:{title:"主页",url:"index.html"},items:[{title:"集货管理",url:"javascript:;",isActive:!1,icon:"fa fa-laptop",child:[{title:"库存查询",url:".collectStorage",isActive:!1},{title:"药材筹措",url:".collectSupplement",isActive:!1}]},{title:"仓储管理",url:"javascript:;",isActive:!1,icon:"fa fa-home",child:[{title:"收货验收",url:".wareEntry",isActive:!1},{title:"入库上架",url:".wareShelves",isActive:!1},{title:"货位管理",url:".wareInventory",isActive:!1},{title:"保管养护",url:".wareMaintain",isActive:!1}]},{title:"订单管理",url:"javascript:;",isActive:!1,icon:"fa fa-cogs",child:[{title:"订单录入",url:".orderAdd",isActive:!1},{title:"订单查询",url:".orderQuery",isActive:!1},{title:"订单审核",url:".orderAudit",isActive:!1}]},{title:"配货管理",url:"javascript:;",isActive:!1,icon:"fa fa-briefcase",child:[{title:"拆单拣货",url:".allocateGoods",isActive:!1},{title:"装箱核对",url:".allocateCheck",isActive:!1}]},{title:"配载管理",url:"javascript:;",isActive:!1,icon:"fa fa-archive",child:[{title:"选配货载",url:".loadSelect",isActive:!1},{title:"配载查询",url:".loadQuery",isActive:!1}]},{title:"运输管理",url:"javascript:;",isActive:!1,icon:"fa fa-truck",child:[{title:"车辆信息",url:".transVehicle",isActive:!1},{title:"线路分配",url:".transLine",isActive:!1},{title:"车辆调度",url:".transDispatch",isActive:!1}]},{title:"药材管理",url:"javascript:;",isActive:!1,icon:"fa fa-bar-chart-o",child:[{title:"药材字典",url:".dicSingle",isActive:!1}]},{title:"业务统计",url:"javascript:;",isActive:!1,icon:"fa fa-book",child:[{title:"订单统计",url:"javascript:;",isActive:!1},{title:"保障能力",url:"javascript:;",isActive:!1}]},{title:"机构管理",url:"javascript:;",isActive:!1,icon:"fa fa-sitemap",child:[{title:"供应机构",url:".instSupply",isActive:!1},{title:"需求机构",url:".instDemand",isActive:!1},{title:"保障关系",url:".instSafety",isActive:!1}]},{title:"用户管理",url:"javascript:;",isActive:!1,icon:"fa fa-user",child:[{title:"教员用户",url:".userTeacher",isActive:!1},{title:"学员用户",url:".userStudent",isActive:!1}]}]},e.isActive=!1,e.listToggle=function(t){e.list.items[t].isActive=!e.list.items[t].isActive}}]),app.controller("TransDispatchCtrl",["$scope","$rootScope","http","$filter","instruct",function(e,t,r,i,n){n.set(["本页面是车辆调度页面<h1>a</h1>","此处放置有关页面调度的说明文字","又是一条说明"]),t.$broadcast("instructChange"),e.alerts=[],e.closeAlert=function(t){e.alerts.splice(t,1)},e.setAlertClose=function(t){e.alerts.push(t);setTimeout(function(){e.closeAlert(-1)},5e3)},e.stateFactory={query:!0,detail:!1,dispatch:!1},e.changeState=function(t){for(o in e.stateFactory)e.stateFactory[o]=!1;e.stateFactory[t]=!0},e.carStatusList=[{state:"休整中",color:"btn-info"},{state:"休整完毕",color:"btn-info"},{state:"待命中",color:"btn-success"},{state:"装载中",color:"btn-warning"},{state:"装载完毕",color:"btn-warning"},{state:"发车中",color:"btn-danger"},{state:"发车完毕",color:"btn-danger"},{state:"前运中",color:"btn-default"},{state:"回程中",color:"btn-primary"},{state:"回程完毕",color:"btn-primary"}],e.queryAllCarsWithCode=function(){r.post({method:"queryAllCarsWithCode",agencyCode:"B0004"},URL.CarServlet).then(function(t){e.cars=t.carStatus},function(e){alert(JSON.stringify(e))})},e.queryAllCarsWithCode(),e.queryTrancarDetail=function(t,o){var i={method:"findStowageCodesByCarCode",carCode:t,carStatus:o};r.post(i,URL.CarServlet).then(function(t){e.stowageCodeList=t.stowageCode,e.changeState("detail")},function(e){alert(JSON.stringify(e))})},e.queryStowageList=function(t){var o={method:"findStowageByCode",stowageCode:t};r.post(o,URL.StowageServlet).then(function(t){if(0===t.code){var o=t.stowage;angular.forEach(o.stowageItems,function(e,t,o){e.invoiceTime=i("date")(e.invoiceTime,"yyyy-MM-dd HH:mm:ss"),e.signedTime=i("date")(e.signedTime,"yyyy-MM-dd HH:mm:ss")}),e.stowageList=angular.copy(o)}else alert("数据返回错误")},function(e){alert(JSON.stringify(e))})},e.updateStowageItems=function(){angular.forEach(e.stowageList.stowageItems,function(t,o,r){t.stowageCode=e.stowageCode});var t={method:"updateStowageItems",stowageItems:JSON.stringify(e.stowageList.stowageItems)};console.log(JSON.stringify(e.stowageList.stowageItems)),r.post(t,URL.StowageServlet).then(function(e){0===e.code?alert("保存成功"):alert("数据返回错误")},function(e){alert(JSON.stringify(e))})},e.currentCar="",e.operatorList=[],e.queryDispatchDetail=function(t){e.getOperator(),e.changeState("dispatch"),e.currentCar=t,e.queryDispatchPlan(t,"休整完毕")},e.getOperator=function(){var t={method:"findOperatorByPosition",position:"驾驶员"};r.post(t,URL.OperatorServlet).then(function(t){e.operatorList=t.operators,console.log(JSON.stringify(t.operators))},function(e){alert(JSON.stringify(e))})},e.updateCarStatus=function(e,t){var o={method:"updateCarStatusByCode",carCode:e,carStatus:t};r.post(o,URL.CarServlet).then(function(e){alert("状态更新成功")},function(e){alert(JSON.stringify(e))})},e.dispatchDirect="",e.updateDirectives=function(){var t={method:"updateInstructionByCode",instruction:e.dispatchDirect,carCode:e.currentCar};r.post(t,URL.CarServlet).then(function(e){0===e.code?alert("指令发送成功"):alert("数据返回错误，请再次尝试")},function(e){alert(JSON.stringify(e))})},e.queryDispatchPlan=function(t,o){var i={method:"findStowageCodesByCarCode",carCode:t,carStatus:o};r.post(i,URL.CarServlet).then(function(t){e.dispatchOrders=t.stowageCode},function(e){alert(JSON.stringify(e))})},e.dispatchOrdersDetail={},e.dispatchOrdersItems="",e.queryDispatchPlanDetail=function(t){var o={method:"findStowageByCode",stowageCode:t};r.post(o,URL.StowageServlet).then(function(t){if(0===t.code){e.dispatchOrdersDetail=t.stowage,console.log(JSON.stringify(t.stowage));var o=[];angular.forEach(e.dispatchOrdersDetail.stowageItems,function(e,t,r){o.push(e.receiptAddress)}),e.dispatchOrdersItems=o.join(",")}else alert("数据返回错误")},function(e){alert(JSON.stringify(e))})},e.updateDispatchPlan=function(){var t=JSON.stringify({stowageCode:e.selectedOg,operator:e.selectedOperator.operatorName,loadTime:e.dispatchOrdersDetail.loadTime,departureTime:e.dispatchOrdersDetail.departureTime}),o={method:"updateStowage",stowage:t+""};r.post(o,URL.StowageServlet).then(function(e){0===e.code?alert("保存成功"):alert("保存出错："+e)},function(e){alert(JSON.stringify(e))})}}]),app.controller("TransLineCtrl",["$scope","http",function(e,t){e.queryAllCarLines=function(){t.post({method:"findAllGuaranteeRelationShipsBySupplyAgencyCode",supplyAgencyCode:""},URL.GuaranteeRelationShipServlet).then(function(t){e.carLines=t.guaranteeRelationShips},function(e){alert(JSON.stringify(e))})},e.queryAllCarLines(),e.edit=function(t){e.carLines[t].transportRouteEdit=!e.carLines[t].transportRouteEdit},e.update=function(r){console.log("update item :"+r),t.post({method:"updateGuaranteeRelationShip",guaranteeRelationShip:o(e.carLines[r])},URL.GuaranteeRelationShipServlet).then(function(t){alert("线路已更新"),e.edit(r)},function(e){alert(JSON.stringify(e))})};var o=function(e){return JSON.stringify({demandAgencyCode:e.demandAgencyCode,supplyAgencyCode:e.supplyAgencyCode,transportRoute:e.transportRoute})}}]),app.controller("TransVehicleCtrl",["$scope","http",function(e,t){e.stateFactory={query:!0,detail:!1,perform:!1};var r;e.changeState=function(t,i){for(o in e.stateFactory)e.stateFactory[o]=!1;e.stateFactory[t]=!0,"detail"==t&&(r=isEmptyValue(i)?"addCar":"updateCar",e.car=i),"perform"==t&&(e.carRecords=i.carRecords)},e.queryAllCars=function(){t.post({method:"queryAllCars",numberOrCode:e.carNumber,agencyCode:"B0004"},URL.CarServlet).then(function(t){alert("车辆查询成功"),e.cars=t.cars},function(e){alert(JSON.stringify(e))})},e.updateCar=function(){return"updateCar"==r&&isEmptyValue(e.car.id)?void alert("更新车辆的id不能为空！"):void t.post({method:r,car:JSON.stringify(e.car)},URL.CarServlet).then(function(t){alert(r+" success!"),e.changeState("query"),"addCar"==r&&(e.car.id=t.id,isEmptyValue(e.cars)&&(e.cars=[]),e.cars.push(angular.copy(e.car)),console.log(e.cars))},function(e){console.log(e),alert(JSON.stringify(e))})},e.deleteCar=function(o,r){return isEmptyValue(o)?void alert("被删除项id不能为空！"):void t.post({method:"deleteCar",ids:o},URL.CarServlet).then(function(t){alert("删除成功！"),e.cars.splice(r,1)},function(e){alert(JSON.stringify(e))})}}]),app.controller("UserStudentCtrl",["$scope","http",function(e,t){var o=0;e.user={userCode:"测试用户",userName:"测试",userType:"学员",userPassword:"123322",studentId:"20131202",className:"药理2班",startTime:"2016-08-01",endTime:"2016-11-01"},e.userPassword="",e.updateUser=function(){return e.userPassword!=e.user.userPassword?void alert("两次密码输入不一致！"):void t.post({method:"updateUser",user:JSON.stringify({id:o,userPassword:e.userPassword})},URL.UserServlet).then(function(e){console.log("=========密码修改成功！========="+JSON.stringify(e)),alert("密码修改成功！！")},function(e){console.log("updateUser failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})}}]),app.controller("UserTeacherCtrl",["$scope","http",function(e,t){e.users=[];var o=[];e.queryInfo={userCode:"",userName:"",userType:"",className:""},e.queryUser=function(){t.post({method:"queryUser",userCode:e.queryInfo.userCode,userName:e.queryInfo.userName,userType:e.queryInfo.userType,className:e.queryInfo.className},URL.UserServlet).then(function(t){e.users=t.order,alert("queryUser success!")},function(e){console.log("queryUser failed!"+JSON.stringify(e)),alert(e)})},e.newAccount={},e.isCreateAccount=!1,e.editable=!1,e.label="修改",e.createAccount=function(){e.isCreateAccount=!0,o=angular.copy(e.users),e.users=[]},e.save=function(){isEmptyValue(e.newAccount)||t.post({method:"addUser",user:i(e.newAccount)},URL.UserServlet).then(function(t){console.log("=========已保存========="+JSON.stringify(t)),alert("已保存！"),e.isCreateAccount=!1,e.newAccount={},e.queryInfo={userCode:"",userName:"",userType:"",className:""},e.queryUser()},function(e){console.log("addUser failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})},e.cancel=function(){e.isCreateAccount=!1,e.newAccount={},e.users=o},e.edit=function(t){return e.users[t].editable?(e.label="修改",r(e.users[t]),void(e.users[t].editable=!e.users[t].editable)):(e.label="保存",void(e.users[t].editable=!e.users[t].editable))},e.del=function(o){t.post({method:"deleteUser",id:e.users[o].id},URL.UserServlet).then(function(e){console.log("=========已删除========="+JSON.stringify(e)),alert(JSON.stringify(e))},function(e){console.log("deleteUser failed!"+JSON.stringify(e)),alert(JSON.stringify(e))}),e.users.splice(o,1)},e.resetPassword=function(o){e.users[o].userPassword="123456",t.post({method:"resetPassword",id:e.users[o].id},URL.UserServlet).then(function(e){console.log("=========密码已重置========="+JSON.stringify(e)),alert(JSON.stringify(e))},function(e){console.log("resetPassword failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})};var r=function(e){t.post({method:"updateUser",user:i(e)},URL.UserServlet).then(function(e){console.log("=========updateUser========="+JSON.stringify(e)),alert("=========updateUser success!========="+JSON.stringify(e))},function(e){console.log("updateUser failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})},i=function(e){var t=angular.copy(e);return"学员"==t.userType?t.userType=1:t.userType=2,JSON.stringify(t)}}]),app.controller("WareEntryCtrl",["$scope","http",function(e,t){e.entryInfo={recevier:"收货人",receiveStore:"收货仓库",recevierTime:secondsToData((new Date).getTime()),goodsDes:"11111",resource:"来源",supplier:{supply:"大润发",linkMan:"李新雨",tel:"1111111111"},deliver:{deliver:"1号店",linkMan:"田栋炜",tel:"22222222"},receivingNote:"收货单",receivingCode:"凭证号",appearence:"外观",direction:"说明书",qualityReport:"质检报告",checkRecord:"验收",checkMan:"张益达",conclusion:"结论",remark:"备注"},e.conclusion=[{value:0,name:"合格"},{value:1,name:"不合格"}],e.defaultSelect=e.conclusion[0],e.receiverType=[{value:0,name:"请领收货"},{value:1,name:"配发收货"},{value:2,name:"外购收货"},{value:3,name:"其他"}],e.receiverSelect=e.receiverType[0],e.items=[{name:"感冒通灵",productCode:"000002",size:"规格2",type:"型号2",unit:"12粒/盒",factory:"厂家2",productionBatch:"002",purchasePrice:1,quantity:200,factoryTime:"2016-09-02",singleAmount:2,boxQuantity:3,smallAmount:6,boxMark:0,memo:"xxx",editDisabled:!0}],e.newItem={},e.addItem=function(t){t.editDisabled=!0,t.smallAmount||(t.smallAmount=t.boxQuantity*t.singleAmount),e.items.push(t)},e.iptState=!1,e.iptToggle=function(t){e.iptState=t},e.iptReset=function(t){e.newItem={}},e.iptSave=function(t){e.addItem(t),e.iptToggle(!1),e.iptReset(t)},e.reset=function(){e.items=[],e.orderForm={}},e.rmItem=function(t){e.items.splice(t,1)},e.edit=function(t){e.items[t].editDisabled=!1},e.save=function(t){e.items[t].editDisabled=!0},e.cancel=function(t){e.items[t].editDisabled=!0};var o={};e.confirm=function(){o={receiptType:e.receiverSelect.value,receiver:e.entryInfo.recevier,receiptDepot:e.entryInfo.receiveStore,receiptTime:e.entryInfo.recevierTime,goodsDescription:e.entryInfo.goodsDes,source:e.entryInfo.resource,supplierName:e.entryInfo.supplier.supply,supplierContacts:e.entryInfo.supplier.linkMan,supplierTel:e.entryInfo.supplier.tel,deliveryName:e.entryInfo.deliver.supply,deliveryContactes:e.entryInfo.deliver.linkMan,deliveryTel:e.entryInfo.deliver.tel,receiptCertificate:e.entryInfo.receivingNote,certificateNumber:e.entryInfo.receivingCode,acceptanceRecord:e.entryInfo.checkRecord,acceptor:e.entryInfo.checkMan,acceptanceResult:e.defaultSelect.name,memo:e.entryInfo.remark},r()};var r=function(){t.post({method:"addReceiptAcceptanceRecord",receiptAcceptanceRecord:JSON.stringify(o),receiptItems:JSON.stringify(e.items)},URL.RARS).then(function(e){alert("已确认！")},function(e){console.log("addReceiptAcceptanceRecord failed!"+JSON.stringify(e)),alert(e)})}}]),app.controller("WareInventoryCtrl",["$scope","http",function(e,t){function o(o){s=o,t.post({method:"findDepotByCode",depotCode:o},URL.DepotServlet).then(function(t){e.selectedList.cargoAreas=t.depots.cargoAreas,r(e.selectedList.cargoAreas),alert("仓库查询完成！")},function(e){console.log("findDepotByCode failed!"+JSON.stringify(e)),alert(e)})}function r(t){var o=[];angular.forEach(t,function(e){o=o.concat(e.locators)}),e.locators=o,console.log("========create locators========"+JSON.stringify(o))}function i(t){angular.forEach(t,function(t,o,r){isInArray(e.selectCargoAreaList,{cargoCode:t.cargoAreaCode})||e.selectCargoAreaList.push({cargoCode:t.cargoAreaCode})}),console.log("$scope.selectCargoAreaList:"+JSON.stringify(e.selectCargoAreaList))}function n(o){t.post({method:"findCargoAreaCodesByDepotCode",depotCode:o},URL.CargoAreaServlet).then(function(t){console.log("=========货区分配========="+JSON.stringify(t)),e.cargoAreaAssignArray=t.cargoAreaCodes,console.log("=========$scope.cargoAreaAssignArray========="+JSON.stringify(e.cargoAreaAssignArray)),alert("findCargoAreaCodesByDepotCode success!")},function(e){console.log("CargoAreaServlet failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})}function a(){e.newDepot={},e.addCargoAreas=[],e.newCargoArea={},e.addShelfList=[],e.newShelft={},e.addNewShelfs=[],e.isNewAdjustShelve=!1}function c(o){t.post({method:"queryAllShelfs",depotCode:o},URL.ShelfServlet).then(function(t){console.log("=========查询货架调整========="+JSON.stringify(t)),e.addAdjustShelfList=t.shelfs,alert("queryAllShelfsByDepotCode success!")},function(e){console.log("queryAllShelfs failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})}var s;e.states={basicState:!1,editMode:!1,addNewMode:!1,currentWare:-1},e.editWare=function(){e.states.addNewMode||(e.states.editMode=!e.states.editMode)},e.addWare=function(){e.toggleMode(!0),e.states.basicState=!0,e.hasSaveDepot=!1,a()},e.toggleMode=function(t){e.states.addNewMode=t},e.wareList=[{id:1,depotCode:12,depotName:"测试仓库",depotType:"品类",depotAddress:"东大街1号",principal:null,depotLength:0,depotWidth:0,depotHeigth:0,depotVolume:0,cargoAreas:null,depotNumber:0,reservoirs:null,depotCount:0}],e.selectedList={},e.updateSelection=function(t,r,i){t.target;e.states.basicState=!0,e.states.editMode=!1,e.toggleMode(!1),e.selectedList={},e.selectedList=angular.copy(r),e.states.currentWare=i,o(r.depotCode),c(r.depotCode),n(r.depotCode)},e.selectWare=function(t){e.states.editMode=!1,e.toggleMode(!1),e.states.currentWare=t},e.newAreaList={},e.isNewArea=!1,e.addNewArea=function(){e.isNewArea=!e.isNewArea},e.saveNewArea=function(){e.isNewArea=!1},e.newShelveList={},e.isNewShelve=!1,e.addNewShelve=function(){e.isNewShelve=!e.isNewShelve},e.saveNewShelve=function(){e.isNewShelve=!1},t.post({method:"queryAllDepots"},URL.DepotServlet).then(function(t){e.wareList=t.depots},function(e){console.log("queryAllDepots failed!"+JSON.stringify(e))}),e.hasSaveDepot=!1,e.newDepot={},e.addNewDepot=function(){return isEmptyValue(e.newDepot)?void alert("仓库信息不能为空！"):(e.newDepot.id=e.wareList[e.wareList.length-1].id+1,e.wareList.push(angular.copy(e.newDepot)),console.log(e.wareList),e.hasSaveDepot=!0,void t.post({method:"addDepot",depot:JSON.stringify(e.newDepot)},URL.DepotServlet).then(function(e){console.log("=========新建仓库========="+JSON.stringify(e)),alert(JSON.stringify(e))},function(e){console.log("addDepot failed!"+JSON.stringify(e)),alert(JSON.stringify(e))}))},e.selectCargoAreaList=[],e.addCargoAreas=[],e.newCargoArea={},e.addNewCargoArea=function(){return isEmptyValue(e.newDepot)?void alert("请先输入仓库基本信息，并保存！"):(e.newCargoArea.depotCode=angular.copy(e.newDepot).depotCode,e.addCargoAreas.push(angular.copy(e.newCargoArea)),void(e.newCargoArea={}))},e.editNewCargoArea=!0,e.cancelCargoArea=function(t,o){switch(t){case 0:e.isNewArea=!e.isNewArea;break;case 1:e.addCargoAreas.splice(o,1);break;case 2:}},e.editCargoArea=function(){e.editNewCargoArea=!e.editNewCargoArea},e.saveNewCargoAreas=function(){return isEmptyValue(e.newDepot)?void alert("请先输入仓库基本信息，并保存！"):(e.isNewArea=!1,isEmptyValue(e.addCargoAreas)?void alert("货区信息不能为空！"):void t.post({method:"addCargoArea",cargoAreas:JSON.stringify(e.addCargoAreas)},URL.CargoAreaServlet).then(function(t){console.log("=========新建货区========="+JSON.stringify(t)),alert(JSON.stringify(t)),i(angular.copy(e.addCargoAreas))},function(e){console.log("CargoAreaServlet add failed!"+JSON.stringify(e)),alert(JSON.stringify(e))}))},e.selectCargoArea=function(t,o){e.states.addNewMode?(e.addShelfList[o].cargoAreaCode=t.cargoAreaCode.cargoCode,console.log("添加模式："+JSON.stringify(e.addShelfList[o]))):console.log("调整模式："+JSON.stringify(e.addAdjustShelfList[o]))},e.addShelfList=[],e.newShelft={},e.addNewShelft=function(){return isEmptyValue(e.newDepot)?void alert("请先输入仓库基本信息，并保存！"):isEmptyValue(e.newShelft)?void alert("请填写货架信息！"):(e.newShelft.depotCode=angular.copy(e.newDepot).depotCode,e.newShelft.shelfCode=e.addShelfList.length+1,e.addShelfList.push(angular.copy(e.newShelft)),e.newShelft={},void console.log("------$scope.addShelfList------"+JSON.stringify(e.addShelfList)))},e.editNewShelft=!0,e.cancelShelft=function(t,o){switch(t){case 0:e.isNewShelve=!e.isNewShelve;break;case 1:e.addShelfList.splice(o,1);break;case 2:}},e.editShelft=function(){e.editNewShelft=!e.editNewShelft},e.saveNewShelft=function(){return isEmptyValue(e.newDepot)?void alert("请先输入仓库基本信息，并保存！"):(e.isNewShelve=!1,isEmptyValue(e.addShelfList)?void alert("货架信息为空！"):void t.post({method:"addShelf",shelfs:JSON.stringify(e.addShelfList)},URL.ShelfServlet).then(function(t){console.log("=========新建货架========="+JSON.stringify(t)),alert(JSON.stringify(t)),e.addNewShelfs=angular.copy(e.addShelfList)},function(e){console.log("addShelf add failed!"+JSON.stringify(e)),alert(JSON.stringify(e))}))},e.updateCargoAreaCodes=function(){var o="";o=e.states.addNewMode?JSON.stringify(e.addShelfList):JSON.stringify(e.addAdjustShelfList),t.post({method:"updateShelf",shelfs:o},URL.ShelfServlet).then(function(e){console.log("=========updateShelf========="+JSON.stringify(e)),
alert("updateShelf success!"+JSON.stringify(e))},function(e){console.log("updateShelf failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})},e.saveEditWare=function(){e.states.addNewMode||(e.states.editMode=!e.states.editMode,e.wareList[e.states.currentWare]=angular.copy(e.selectedList),t.post({method:"updateDepot",depot:JSON.stringify(e.selectedList)},URL.DepotServlet).then(function(e){console.log("=========调整仓库========="+JSON.stringify(e)),alert(JSON.stringify(e))},function(e){console.log("调整货仓库failed!"+JSON.stringify(e)),alert(JSON.stringify(e))}))},e.newCargoAreaAdjust={},e.isNewAreaAdjust=!1,e.editAdjustCargoArea=!0,e.addCargoArea=function(){e.isNewAreaAdjust=!e.isNewAreaAdjust},e.addAdjustCargoArea=function(){e.newCargoAreaAdjust.depotCode=s,e.selectedList.cargoAreas.push(angular.copy(e.newCargoAreaAdjust)),e.newCargoAreaAdjust={}},e.cancelAdjustCargoArea=function(t,o){switch(t){case 0:e.isNewAreaAdjust=!e.isNewAreaAdjust,e.newCargoAreaAdjust={};break;case 1:e.selectedList.cargoAreas.splice(o,1);break;case 2:}},e.editAdjust=function(){e.editAdjustCargoArea=!e.editAdjustCargoArea},e.saveAdjustCargoAreas=function(){return e.isNewAreaAdjust=!1,isEmptyValue(e.selectedList.cargoAreas)?void alert("货区信息不能为空！"):void t.post({method:"updateCargoArea",cargoAreas:JSON.stringify(e.selectedList.cargoAreas)},URL.CargoAreaServlet).then(function(e){console.log("=========调整货区========="+JSON.stringify(e)),alert(JSON.stringify(e))},function(e){console.log("updateCargoArea failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})},e.addAdjustShelfList=[],e.newAdjustShelft={},e.addNewAdjustShelve=function(){e.isNewAdjustShelve=!e.isNewAdjustShelve},e.addNewAdjustShelft=function(){return isEmptyValue(e.newAdjustShelft)?void alert("请填写货架信息！"):(e.newAdjustShelft.depotCode=s,e.newAdjustShelft.shelfCode=e.addAdjustShelfList.length+1,e.addAdjustShelfList.push(angular.copy(e.newAdjustShelft)),void(e.newAdjustShelft={}))},e.editNewAdjustShelft=!0,e.cancelAdjustShelft=function(t,o){switch(t){case 0:e.isNewAdjustShelve=!e.isNewAdjustShelve;break;case 1:e.addAdjustShelfList.splice(o,1);break;case 2:}},e.editAdjustShelft=function(){e.editNewAdjustShelft=!e.editNewAdjustShelft},e.saveNewAdjustShelft=function(){return e.isNewAdjustShelve=!1,isEmptyValue(e.addAdjustShelfList)?void alert("货架信息为空！"):void t.post({method:"updateShelf",shelfs:JSON.stringify(e.addAdjustShelfList)},URL.ShelfServlet).then(function(e){console.log("=========调整货架修改提交========="+JSON.stringify(e)),alert(JSON.stringify(e))},function(e){console.log("addShelf add failed!"+JSON.stringify(e)),alert(JSON.stringify(e))})}}]),app.controller("wareMaintainCtrl",["$scope","http",function(e,t){e.maintainInfo={storage:"1111",recordDate:secondsToData((new Date).getTime()),storeMan:"隔壁老张",storeRoom:[{time:"上午",recordTime:secondsToData((new Date).getTime()),temperature:"25",humidity:"12",adjustMeasures:"xxxx"},{time:"下午",recordTime:secondsToData((new Date).getTime()),temperature:"29",humidity:"10",adjustMeasures:"xxxx"}],storeDevices:"运转正常",check:{maintainPlace:"货区",maintainPeople:"王小二",specNum:10,batchNum:20,quality:"良好",measures:"措施",result:"结果",remark:"备注1111"}},e.storage1=[{value:0,name:"仓库1"},{value:1,name:"仓库2"},{value:2,name:"仓库3"},{value:3,name:"仓库4"}],e.defaultSelect=e.storage1[0];var o={};e.save=function(){o={storageRecordTime:e.maintainInfo.recordDate,depotCode:e.defaultSelect.value+"",storager:e.maintainInfo.storeMan,morningRecordTime:e.maintainInfo.storeRoom[0].recordTime,morningTemperature:e.maintainInfo.storeRoom[0].temperature,morningHumidity:e.maintainInfo.storeRoom[0].humidity,morningMeasure:e.maintainInfo.storeRoom[0].adjustMeasures,afternoonRecordTime:e.maintainInfo.storeRoom[1].recordTime,afternoonTemperature:e.maintainInfo.storeRoom[1].temperature,afternoonHumidity:e.maintainInfo.storeRoom[1].humidity,afternoonMeasure:e.maintainInfo.storeRoom[1].adjustMeasures,equipmentSituation:e.maintainInfo.storeDevices,conserveReservoir:e.maintainInfo.check.maintainPlace,conserver:e.maintainInfo.check.maintainPeople,conserveNumber:e.maintainInfo.check.specNum+"",conserveBatch:e.maintainInfo.check.batchNum+"",qualityStatus:e.maintainInfo.check.maintainPeople,conserveMeasure:e.maintainInfo.check.quality,handleResult:e.maintainInfo.check.result,memo:e.maintainInfo.check.remark},r()};var r=function(){t.post({method:"addStorageRecord",storageRecord:JSON.stringify(o)},URL.storageRecordServlet).then(function(e){console.log("=========保管养护========="+JSON.stringify(e)),alert("已保存！")},function(e){console.log("saveStorage failed!"+JSON.stringify(e)),alert(e)})}}]),app.controller("WareShelvesCtrl",["$scope","http",function(e,t){e.items=[{id:1,receiptCode:"20160906111111",receiptTime:"2016-09-06 11:11:11",goodsDescription:"货物描述",receiptType:"配发收货",supplierName:"供货商名称",deliveryName:"送货商"},{id:2,receiptCode:"20160907121212",receiptTime:"2016-09-07 12:12:12",goodsDescription:"货物描述",receiptType:"外购收货",supplierName:"供货商名称",deliveryName:"送货商名称"},{id:5,receiptCode:"20160907113740",receiptTime:"2016-09-07 11:37:40",goodsDescription:"11111",receiptType:"配发收货",supplierName:"大润发"}],e.stateBox=[!1,!1,!1],e.toggleState=function(t,o,r){var i=o;i.stopPropagation();for(var n=0;n<e.stateBox.length;n++)e.stateBox[n]=!1;e.stateBox[t]=!0,e.queryDetail(r)},e.queryReciver=function(){console.log("llllllllll:"+e.startTime+" / endTime :"+e.endTime),t.post({method:"queryAllReceiptAcceptanceRecords",receiptTimeStartStr:e.startTime,receiptTimeEndStr:e.endTime},URL.RARS).then(function(t){e.items=t.receiptAcceptanceRecords,console.log("=========queryAllReceiptAcceptanceRecords========="+JSON.stringify(t))},function(e){console.log("queryAllReceiptAcceptanceRecords failed!"+JSON.stringify(e)),alert(e)})},e.queryDetail=function(o){t.post({method:"queryRecordAndItemByCode",receiptCode:o},URL.RARS).then(function(t){e.entryInfo=t.receiptAcceptanceRecord,angular.forEach(e.entryInfo.items,function(e){e.productArea="",e.plotRatio=0}),console.log("=========queryRecordAndItemByCode========="+JSON.stringify(t))},function(e){console.log("queryRecordAndItemByCode failed!"+JSON.stringify(e)),alert(e)})},e.receiverType=[{value:0,name:"请领收货"},{value:1,name:"配发收货"},{value:2,name:"外购收货"},{value:3,name:"其他"}],e.receiverSelect=e.receiverType[0],e.confirmEntryInfo=function(e){var o=[];angular.forEach(e,function(e){o.push({productCode:e.productCode,caseQuantity:e.quantity,banchNumber:e.productionBatch,locatorName:e.productArea,caseNumber:e.boxMark,factoryTime:e.factoryTime,status:1,receiptCode:e.receiptCode,memo:e.memo})}),t.post({method:"addStock",stocks:JSON.stringify(o)},URL.stockQurey).then(function(e){console.log("=========入库提交========="+JSON.stringify(e)),alert("已成功入库！")},function(e){console.log("=========入库失败============"+JSON.stringify(e)),alert(JSON.stringify(e))})},e.entryInfo={id:1,receiptCode:"20160906111111",receiptTime:1473174671e3,receiptDepot:"收货仓库",receiver:"收货人",goodsDescription:"货物描述",supplierName:"供货商名称",supplierContacts:"供货商联系人",supplierTel:"供货商电话",deliveryName:"送货商",deliveryContactes:"送货商联系人",deliveryTel:"送货商电话",appearanceDetermination:0,manualDetermination:0,qualityDetermination:0,acceptanceRecord:null,acceptor:null,acceptanceResult:null,receiptType:1,source:"来源",memo:"备注",receiptCertificate:"收货凭证",certificateNumber:"凭证号",items:[{id:1,receiptCode:"20160906111111",productCode:10000001,purchasePrice:1.5,boxMark:0,boxQuantity:2,quantity:40,factoryTime:1470922737e3,productionBatch:"20160811",memo:"收货明细",product:{id:1,productCode:10000001,ordinaryName:"4430吸头",productName:"待补",specifications:"规格",unit:"个",minPrice:100.1,minVolume:.01,minNumber:1,minWeight:1,price:1.5,volume:.001,weight:1,firstLevel:"试剂耗材",secondLevel:"耗材",manufactor:"厂家",approvalNumber:null,validity:36,unitDose:0,averageDose:0,averageNumber:0,maxNumber:0,createTime:1465398097e3,model:"型号",minStock:10,maxStock:1e3,supplier:"供应商"},stock:{id:8,productCode:10000001,caseQuantity:50,inStockTime:1473476364e3,outStockTime:null,banchNumber:20160606,locatorName:"fenpeihuowei",locatorCode:null,memo:"入库",caseNumber:"2",status:0,factoryTime:null,receiptCode:null,stockQuantity:0,stockValue:0,stockLevel:0,stockStatus:null,product:null}}]}}]),app.controller("WareStorageCtrl",["$scope","http",function(e,t){function o(e,t){for(var o in t)e[o]=t[o]}e.modalToggle=function(t){e.modalState=t},e.mapping={productCode:"商品编号",ordinaryName:"通用名",productName:"商品名",specifications:"规格型号",manufactory:"生产厂家",unit:"计量单位",carLoad:"包装规格",validity:"有效期",driver:"生产日期",stockNumber:"库存数量",memo:"备注"},e.vehicleList={code:0,vehicle:[{carCode:"车辆编号",carNumber:"车牌号",carName:"车名",carType:"车型",carUnit:"所属单位",carSize:"尺寸",carLoad:"载重",capacity:"容积",driver:"司机",status:"状态",memo:"备注"},{carCode:"C0001",carNumber:"沪C0001",carName:"1号车",carType:"车型",carUnit:"第1车队",carSize:"5000",carLoad:"50",capacity:"5000",driver:"王二",status:"运输中",memo:"备注"}]},e.detail={},e.tempItem={},e.showDetail=function(t,r){e.modalToggle(!0),o(e.tempItem,r),e.detail.item=r,e.detail.index=t},e.saveChange=function(){var t=e.detail.index,r=e.vehicleList.vehicle[t];o(r,e.tempItem),e.modalToggle(!1)},e.cancelChange=function(){o(e.tempItem,e.detail.item),e.modalToggle(!1)},e.newItem={},e.addItem=function(t){e.vehicleList.vehicle.push({carCode:t.carCode,carNumber:t.carNumber,carName:t.carName,carType:t.carType,carUnit:t.carUnit,carSize:t.carSize,carLoad:t.carLoad,capacity:t.capacity,driver:t.driver,memo:t.memo})},e.rmItem=function(t){e.vehicleList.vehicle.splice(t,1)},e.iptState=!1,e.iptToggle=function(t){e.iptState=t},e.iptReset=function(t){e.newItem={}},e.iptSave=function(t){e.addItem(t),e.iptToggle(!1),e.iptReset(t)},e.queryStorage=function(){t.post({method:"queryAllStocks"},URL.stockQurey).then(function(e){console.log("=========查询库存信息========="+JSON.stringify(e))},function(e){console.log("queryAllStocks failed!"+JSON.stringify(e)),alert(e)})},e.queryStorage()}]);